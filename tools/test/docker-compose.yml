# https://github.com/testjavascript/nodejs-integration-tests-best-practices#section-1-infrastructure-and-database-setup
version: '3.9'
services:
  database:
    image: postgres:12
    command: postgres -c fsync=off -c synchronous_commit=off -c full_page_writes=off -c random_page_cost=1.0
    env_file:
      - .env.test
    container_name: 'postgres_test'
    ports:
      - '${POSTGRES_PORT}:${POSTGRES_PORT}'
    tmpfs: /var/lib/postgresql/data
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -U postgres']
      interval: 2s
      timeout: 2s
      retries: 10
  hasura-engine:
    image: 'hasura/graphql-engine:${HASURA_VERSION}.cli-migrations-v3'
    container_name: 'hasura_test'
    env_file:
      - .env.test
